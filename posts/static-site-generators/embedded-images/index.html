<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Schemescape: Embedding images directly into Markdown posts -- terrible idea?</title>
<meta name="description" content="How should images be attached to Markdown posts? Let&#x27;s see how embedding them directly works." />

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link rel="stylesheet" href="../../../css/style.css" />
<link rel="alternate" type="application/rss+xml" href="../../../feed.xml" />
</head>
<body>
<header>
<h1><a href="../../../">Schemescape</a></h1>
<p>Development log of a life-long coder</p>
<nav>
<ul>
<li><a href="../../../posts/static-site-generators">static-site-generators</a></li>
</ul>
</nav>
</header>
<main>
<article>
<header>
<h1><a href=".">Embedding images directly into Markdown posts -- terrible idea?</a></h1>
<p><time datetime="2021-09-21">September 21, 2021</time></p>
</header>
<p>This might turn out to be a terrible idea, but in pursuit of self-contained Markdown-based blog posts, I&#39;m going to try embedding images (and, maybe later, other assets) directly into my Markdown posts.</p>
<h1 id="background">Background</h1>
<p>Most blogging platforms I&#39;ve looked at support inserting images into posts as follows:</p>
<ul>
<li>Images are uploaded to a specific location</li>
<li>Output HTML files reference the images (ideally using relative links)</li>
</ul>
<p>This is great if an image needs to be shared between posts, but that&#39;s not the typical use case. In the usual case, I see images used once in a single post.</p>
<p>As a <em>viewer</em> I like this setup because the images can be loaded lazily, I can open the image link in a new tab, etc.</p>
<h1 id="gripes">Gripes</h1>
<p>As an author, however, I have some complaints about this setup because posts and images become coupled:</p>
<ul>
<li>I have to add multiple files to build a particular post</li>
<li>If I want to remove a post, I have to also remove the images it contains</li>
<li>Probably not common, but if I want to duplicate a post elsewhere, I have to grab the images as well</li>
</ul>
<h1 id="my-previous-solution">My previous solution</h1>
<p>In the past, my solution to this problem was to build a directory for each post and the directory contained both the post content as well as any associated images and files.</p>
<p>This is, in my opinion, a pretty reasonable solution because now the entire post is contained in a single location. If my crazy new idea doesn&#39;t work, I&#39;ll probably revert to this tried and true solution.</p>
<h1 id="directly-embedding-images">Directly embedding images</h1>
<p>So here&#39;s my crazy idea: what if I embed images directly into their source Markdown files using <a href="https://en.wikipedia.org/wiki/Base64">Base64-encoded</a> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">Data URLs</a>?</p>
<p>Data URLs are only recommended for small files (ideally &lt; 1 KB), but my research indicates that this recommendation is based on:</p>
<ol>
<li>Separating essential HTML/text content from slightly less important image content</li>
<li>Some HTML/XML implementations arbitrarily limiting the size of an element and its attributes</li>
</ol>
<p>I happen to agree with #1, so when compiling my site I do plan to split out images into their own files. But #2 feels like a vestigial limitation from the days of allocating fixed size buffers on the stack in C code. That&#39;s not to say #2 won&#39;t cause me trouble--I just don&#39;t think it&#39;s a good enough reason on its own to discard my idea.</p>
<h2 id="prototype-encoder">Prototype encoder</h2>
<p>Here&#39;s the code for my prototype encoder (side note: I don&#39;t know why Node refused to accept the clearly documented &quot;base64url&quot; encoding):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs/promises&quot;</span>);

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Use a more comprehensive library</span>
<span class="hljs-keyword">const</span> fileExtensionToMimeType = {
    <span class="hljs-string">&quot;.jpg&quot;</span>: <span class="hljs-string">&quot;image/jpeg&quot;</span>,
    <span class="hljs-string">&quot;.png&quot;</span>: <span class="hljs-string">&quot;image/png&quot;</span>,
};

(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">const</span> filePath = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];
        <span class="hljs-keyword">if</span> (!filePath) <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;No path specified!&quot;</span>;
    
        <span class="hljs-keyword">const</span> fileExtension = path.<span class="hljs-title function_">extname</span>(filePath);
        <span class="hljs-keyword">const</span> mimeType = fileExtensionToMimeType[fileExtension];
        <span class="hljs-keyword">if</span> (!mimeType) <span class="hljs-keyword">throw</span> <span class="hljs-string">`Could not determine MIME type for extension &quot;<span class="hljs-subst">${fileExtension}</span>&quot;!`</span>;
    
        <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath);
        <span class="hljs-keyword">const</span> base64UrlEncoded = <span class="hljs-built_in">encodeURI</span>(buffer.<span class="hljs-title function_">toString</span>(<span class="hljs-string">&quot;base64&quot;</span>));
    
        <span class="hljs-keyword">const</span> dataUrl = <span class="hljs-string">`data:<span class="hljs-subst">${mimeType}</span>;base64,<span class="hljs-subst">${base64UrlEncoded}</span>`</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dataUrl);
    }
    <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ERROR: <span class="hljs-subst">${err}</span>`</span>);
    }
})();
</code></pre>
<h2 id="exhibit-a">Exhibit A</h2>
<p>Here&#39;s a very small (in terms of number of bytes) PNG file that&#39;s been directly embedded (this is the ~600 byte <a href="https://en.wikipedia.org/wiki/Favicon">Favicon</a> for my site):</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSpVByuKOGSoThbELxylikWwUNoKrTqYXD+hSUOS4uIouBYc/FisOrg46+rgKgiCHyBubk6KLlLi/5JCixgPjvvx7t7j7h0g1EpMMdrGAUU19XgkLKbSq6LvFZ3oxwB6MC0xQ4smFpNwHV/38PD1LsSz3M/9ObozWYMBHpF4jmm6SbxBPLNpapz3iQOsIGWIz4nHdLog8SPXZYffOOdtFnhmQE/G54kDxGK+heUWZgVdIZ4iDmYUlfKFlMMZzluclVKFNe7JX+jPqisJrtMcRgRLiCIGETIqKKIEEyFaVVIMxGk/7OIfsv0xcsnkKoKRYwFlKJBsP/gf/O7WyE1OOEn+MND+YlkfI4BvF6hXLev72LLqJ4D3GbhSm/5yDZj9JL3a1IJHQO82cHHd1OQ94HIHGHzSJF2yJS9NIZcD3s/om9JA3y3Qteb01tjH6QOQpK6Wb4CDQ2A0T9nrLu/uaO3t3zON/n4AuI1yw2D/uDMAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflCRUXDwx3zQBcAAAAbElEQVQ4y81TMRLAIAgTjzH8/6E8wE52oBDbY2kmz2gSEQTAGg3oXrj7gzSzIycAlrvfG2+x72hGsATRSDPVKm52ZrKIrD5UILqYWSkyRxM/FYhvZn1SJohFPLZy5vy5kSo3lkD2NLaGqfMLF2xqO0/W9QaIAAAAAElFTkSuQmCC" alt="Small embedded PNG file"></p>
<p>Here&#39;s what the Markdown input looks like, for reference:</p>
<pre><code class="language-markdown">![<span class="hljs-string">Small embedded PNG file</span>](<span class="hljs-link">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSpVByuKOGSoThbELxylikWwUNoKrTqYXD+hSUOS4uIouBYc/FisOrg46+rgKgiCHyBubk6KLlLi/5JCixgPjvvx7t7j7h0g1EpMMdrGAUU19XgkLKbSq6LvFZ3oxwB6MC0xQ4smFpNwHV/38PD1LsSz3M/9ObozWYMBHpF4jmm6SbxBPLNpapz3iQOsIGWIz4nHdLog8SPXZYffOOdtFnhmQE/G54kDxGK+heUWZgVdIZ4iDmYUlfKFlMMZzluclVKFNe7JX+jPqisJrtMcRgRLiCIGETIqKKIEEyFaVVIMxGk/7OIfsv0xcsnkKoKRYwFlKJBsP/gf/O7WyE1OOEn+MND+YlkfI4BvF6hXLev72LLqJ4D3GbhSm/5yDZj9JL3a1IJHQO82cHHd1OQ94HIHGHzSJF2yJS9NIZcD3s/om9JA3y3Qteb01tjH6QOQpK6Wb4CDQ2A0T9nrLu/uaO3t3zON/n4AuI1yw2D/uDMAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflCRUXDwx3zQBcAAAAbElEQVQ4y81TMRLAIAgTjzH8/6E8wE52oBDbY2kmz2gSEQTAGg3oXrj7gzSzIycAlrvfG2+x72hGsATRSDPVKm52ZrKIrD5UILqYWSkyRxM/FYhvZn1SJohFPLZy5vy5kSo3lkD2NLaGqfMLF2xqO0/W9QaIAAAAAElFTkSuQmCC</span>)
</code></pre>
<p>I also tested a much larger image file and it worked just as well, but I decided to omit that file from this post because I didn&#39;t want to bloat up this file (and repository) for no good reason.</p>
<h2 id="observations-in-vs-code">Observations in VS Code</h2>
<p>Well, the images render fine in Visual Studio Code&#39;s Markdown Preview window. Syntax highlighting in the Markdown file I&#39;m editing is ok, too. But there is one problem.</p>
<p>I&#39;ve been happily using word-wrapping when editing Markdown files and, unsurprisingly, these enormous strings make word-wrapping pretty much impossible to use. This could end up being fairly annoying. I&#39;ll let this issue marinate in the back of my mind for a bit.</p>
<h2 id="observations-in-githubs-markdown-viewer">Observations in GitHub&#39;s Markdown viewer</h2>
<p>To my surprise, the image did not display at all in GitHub&#39;s Markdown viewer--it just showed a &quot;broken image link&quot; icon. That&#39;s unfortunate because I&#39;d like my site to be as functional as possible when viewed directly on GitHub.</p>
<h2 id="observations-compiling-with-marked">Observations compiling with Marked</h2>
<p>The Markdown appears to have compiled fine using <a href="https://marked.js.org/">Marked</a> (via <a href="https://metalsmith.io/">Metalsmith</a>). It wasn&#39;t noticeably slow or anything either. Great!</p>
<h2 id="observations-viewing-the-resulting-html-in-chromium-based-edge">Observations viewing the resulting HTML in Chromium-based Edge</h2>
<p>Note: as I noted earlier, I&#39;m not normally planning on uploading my static site in this format, but out of sheer curiosity, would this work unmodified?</p>
<p>The images display just fine in my site on Chromium-based Edge. Good to know!</p>
<h1 id="conclusion">Conclusion</h1>
<p>Overall, while I like the idea of having completely self-contained Markdown files, the fact that the images don&#39;t work on GitHub&#39;s Markdown viewer and that the incredibly long text blobs effectively break word-wrapping in VS Code lead me to believe that this was a failed experiment. I don&#39;t think I&#39;ll pursue this method any further.</p>
<p>I&#39;m still happy that I gave it a shot. You never really know until you try!</p>

<footer>
<p><a href="../../../">Back to home</a></p>
</footer>
</article>
</main>
</body>
</html>
