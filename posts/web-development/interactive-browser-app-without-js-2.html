<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Building a browser-based app without JavaScript, part 2</title>
<meta name="description" content="Yes, you can build real-time, interactive browser-based apps without JavaScript. But I wouldn&#39;t suggest using this particular approach." />

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link rel="stylesheet" href="../../css/style.css" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Building a browser-based app without JavaScript, part 2",
  "abstract": "Yes, you can build real-time, interactive browser-based apps without JavaScript. But I wouldn't suggest using this particular approach.",
  "keywords": "web-development",
  "datePublished": "2023-10-26"
}
</script>
</head>
<body>
<header>
<h1><a href="../../index.html">Schemescape</a></h1>
<p>Development log of a life-long coder</p>

<nav>
<strong>Topics:&nbsp;</strong>
<ul>
<li><a href="../../posts/web-development/index.html">web-development</a></li>
</ul>
</nav>
</header>
<main>
<article>
<header>
<h1><a href="../../posts/web-development/interactive-browser-app-without-js-2.html">Building a browser-based app without JavaScript, part 2</a></h1>
<p><time datetime="2023-10-26">October 26, 2023</time></p>
</header>
<p>In the <a href="interactive-browser-app-without-js.html">last post</a>, I brainstormed ideas for creating a real-time, interactive browser-based app without using JavaScript (or WebAssembly).</p>
<p>In this post, I&#39;ll describe a proof-of-concept that I created for <a href="https://itch.io/jam/autumn-lisp-game-jam-2023">Lisp Game Jam (Autumn 2023)</a>.</p>
<p><strong>You can play the game here: <a href="https://foo.schemescape.com/">https://foo.schemescape.com/</a></strong></p>
<p>Source code is here: <a href="https://github.com/jaredkrinke/cl-stuff/tree/main/foolander">https://github.com/jaredkrinke/cl-stuff/tree/main/foolander</a></p>
<h1 id="recap">Recap</h1>
<p>The most difficult adjective to support without JavaScript is &quot;real-time&quot;. In some cases, <a href="https://speckyboy.com/pure-css-games/">CSS itself might be enough</a> (although I truly hope CSS is not bloated enough for implementing a snake game!).</p>
<p>If you don&#39;t need real-time feedback, you can probably get by with regular <a href="https://developer.mozilla.org/en-US/docs/Learn/Forms/Your_first_form">HTML forms</a>, <a href="https://en.wikipedia.org/wiki/Push_technology#Long_polling">long-polling</a>, or even <a href="https://en.wikipedia.org/wiki/Meta_refresh">meta refresh</a>. But if you need immediate feedback for both user input and server state updates, avoiding JavaScript can be tricky.</p>
<p>Here&#39;s what I came up with:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">HTTP 1.1 chunked transfer encoding</a>, for progressively appending HTML/CSS</li>
<li>HTML forms (inside an <code>&lt;iframe&gt;</code>), for providing input (without reloading the main page)</li>
</ul>
<p>I don&#39;t know if this is the best approach (in fact, I doubt it), but it is <em>an</em> approach that is &quot;good enough&quot; for my terrible game.</p>
<h1 id="architecture">Architecture</h1>
<p>The architecture for my game is pretty simple:</p>
<ul>
<li>There&#39;s a table of cells for the game board, each addressable via CSS (I used a class, but probably should have used an id)</li>
<li>This is all pushed as an initial chunk, with the stream kept open (and without closing the <code>&lt;body&gt;</code> and <code>&lt;html&gt;</code> tags)</li>
<li>As the game runs, I modify the color of the table cells by pushing additional CSS rules in additional <code>&lt;style&gt;</code> chunks</li>
<li>I also &quot;overwrite&quot; some HTML by defaulting one class to not being shown, with a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:last-of-type"><code>:last-of-type</code></a> override to show the most recently written element only</li>
<li>Input is handled via HTTP post (with a &quot;session id&quot; string) using an HTML form inside an <code>&lt;iframe&gt;</code> (relegating the &quot;entire page reloads&quot; problem to a frame)</li>
<li>The form&#39;s submission button has an &quot;<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/accesskey">access key</a>&quot; for keyboard-only control--this could be useful for games with multiple buttons, although it requires holding down modifier keys (which vary widely based on operating system and browser)</li>
</ul>
<h1 id="examples">Examples</h1>
<h2 id="table">Table</h2>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;s29_0&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-comment">&lt;!-- Row 29, column 0 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;s29_1&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-comment">&lt;!-- Row 29, column 1 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;s29_2&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-comment">&lt;!-- etc. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;s29_3&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<h2 id="game-board-visual-updates">Game board visual updates</h2>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.s9_12</span> { <span class="hljs-attribute">background-color</span>: yellow }</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> <span class="hljs-comment">&lt;!-- Change row 9, col 12 to yellow --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"><span class="hljs-selector-class">.s6_12</span> { <span class="hljs-attribute">background-color</span>: blue }</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>Note: I should have used ids instead of classes (since they&#39;re unique elements). Also, I could have consolidated multiple same-frame updates into a single <code>&lt;style&gt;</code> tag.</p>
<h2 id="overwriting-the-last-bit-of-html-the-score">&quot;Overwriting&quot; the last bit of HTML (the score)</h2>
<pre><code class="language-css"><span class="hljs-selector-class">.score</span> { <span class="hljs-attribute">display</span>: none }
<span class="hljs-selector-class">.score</span><span class="hljs-selector-pseudo">:last-of-type</span> { <span class="hljs-attribute">display</span>: block }
</code></pre>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span>Score: 0<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- Initial score --&gt;</span>
...
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;score&quot;</span>&gt;</span>Score: 1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- Later, this score is shown instead --&gt;</span>
</code></pre>
<h2 id="input-frame">Input frame</h2>
<p>My game only uses a single button, but multiple buttons are easy to support using distinct forms with hidden inputs. In fact, I used multiple buttons until I decided to simplify at the very end.</p>
<p>Parent page:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;controls?id=cbecixentpsc&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
</code></pre>
<p>Frame body:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;action&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
<span class="hljs-comment">&lt;!-- This id links input to an active instance of the game --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">cbecixentpsc</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;cbecixentpsc&quot;</span>&gt;</span>

<span class="hljs-comment">&lt;!-- This was for supporting multiple buttons --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;action&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;clockwise&quot;</span>&gt;</span>

<span class="hljs-comment">&lt;!-- The actual submit button that is shown in-game --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;â†»&quot;</span> <span class="hljs-attr">accesskey</span>=<span class="hljs-string">&quot;e&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p>The <code>id</code> parameter is tracked on the server to link input to a particular HTTP request (which runs an entire round of the game).</p>
<h1 id="analysis">Analysis</h1>
<p>Give the game a try! If your latency isn&#39;t too high, then it&#39;s somewhat playable.</p>
<p>Of course, I wouldn&#39;t recommend this approach because it has a number of drawbacks:</p>
<ul>
<li>As noted, latency is a problem because <em>every user input event</em> is a new HTTP post -- this is a nontrivial amount of overhead</li>
<li>Also, successive button presses are slow because the entire input frame has to be reloaded</li>
<li>The server can&#39;t handle too many concurrent players because each game holds an HTTP request open for the entire length of the game (I&#39;m using a web server that dedicates a thread to each request, although many web servers don&#39;t do this anymore)</li>
<li>Updating the game board requires evaluating CSS rules, which is obviously less efficient than just drawing, say, a canvas square</li>
<li>&quot;Normal&quot; keyboard input doesn&#39;t really work since HTML can only use access keys (which require holding down some combination of Ctrl/Shift/Alt/Meta/Command)</li>
</ul>
<p>But it <em>does</em> (mostly) work! And it gave me an excuse to mess around with Lisp and participate in a game jam.</p>
<p>Overall, I&#39;m calling this a success since it answered my original question... even if it&#39;s not a technique I&#39;d recommend.</p>
<h1 id="addendum">Addendum</h1>
<h2 id="achievement-not-unlocked">Achievement <em>not</em> unlocked</h2>
<p>Unfortunately, I wasn&#39;t able to achieve one secret goal I had in mind: getting the game to run in a minimalist, no-JavaScript browser, like <a href="https://dillo.org/">Dillo</a>. Apparently Dillo doesn&#39;t support inline frames, so the control scheme doesn&#39;t really work (unless you have another window open to the frame). Additionally, Dillo didn&#39;t seem to like my &quot;streaming CSS&quot; approach--the entire game board just remained its initial blue color.</p>
<p>Oh well. At least I tried.</p>
<h2 id="nginx">nginx</h2>
<p>In order to support HTTPS using nginx, I had to tweak a couple of nginx settings. I&#39;m noting them down here for reference:</p>
<pre><code><span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>; <span class="hljs-comment"># nginx default is 1.0, but chunking is a 1.1 feature</span>
<span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>; <span class="hljs-comment"># Necessary to ensure chunks are forwarded as soon as received</span>
<span class="hljs-attribute">gzip</span> <span class="hljs-literal">off</span>; <span class="hljs-comment"># This is actually the default, chunking only worked with gzip disabled</span>
</code></pre>

<footer>
<p>&crarr; <a href="../../index.html">Back to home</a></p>
</footer>
</article>
</main>

</body>
</html>
