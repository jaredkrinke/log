<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Minimal alerting on Linux for hobby projects</title>
<meta name="description" content="Hacking together the simplest real-time notifications for hobby projects." />

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link rel="stylesheet" href="../../css/style.css" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Minimal alerting on Linux for hobby projects",
  "abstract": "Hacking together the simplest real-time notifications for hobby projects.",
  "keywords": "linux",
  "datePublished": "2025-02-10"
}
</script>
</head>
<body>
<header>
<h1><a href="../../index.html">Schemescape</a></h1>
<p>Development log of a life-long coder</p>

<nav>
<strong>Topics:&nbsp;</strong>
<ul>
<li><a href="../../posts/linux/index.html">linux</a></li>
</ul>
</nav>
</header>
<main>
<article>
<header>
<h1><a href="../../posts/linux/minimal-alerting.html">Minimal alerting on Linux for hobby projects</a></h1>
<p><time datetime="2025-02-10">February 10, 2025</time></p>
</header>
<p>Occasionally, I have a need for real-time notifications for hobby projects. For example, one time I made a multi-player word scramble game for a game jam, and I wanted to be notified when people connected to the game (so that I could ensure there was at least one worthy opponent).</p>
<p>This post covers a (terrible) minimal scheme for setting up these notifications.</p>
<h1 id="overview">Overview</h1>
<p>At a high level, here are the things that need to be built:</p>
<ol>
<li>Some way to detect relevant events</li>
<li>Some way to configure/filter events</li>
<li>Some way to &quot;debounce&quot; events (so I don&#39;t get a million notifications)</li>
<li>Some way to deliver the notification</li>
</ol>
<p>The simplest approach is to just base everything on text files. Let&#39;s get started!</p>
<h1 id="detecting-relevant-events">Detecting relevant events</h1>
<p>There&#39;s no shortcut here. Since I&#39;d like everything to be text-based, I need to instrument my project with text logging. For the game example, I needed to log a message when someone connected to the game server.</p>
<p>For my current (unannounced) project, I&#39;m using Python&#39;s built-in logging library, with an obvious string (&quot;ERROR&quot;).</p>
<p>Redirecting to a file is sufficient:</p>
<pre><code><span class="hljs-keyword">python</span> app.<span class="hljs-keyword">py</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> |tee <span class="hljs-built_in">log</span>.txt
</code></pre>
<ul>
<li><code>2&gt;&amp;1</code> ensures I get both &quot;standard output&quot; and &quot;standard error&quot;</li>
<li><code>tee</code> writes output to a file (&quot;log.txt&quot; in this case) and also displays it (for convenience)</li>
</ul>
<h1 id="configuringfiltering-events">Configuring/filtering events</h1>
<p>Since everything is text, we can just match the live log file for a specific string using <code>tail -c 0 -f</code> (<code>-f</code> to follow the file and <code>-c 0</code> to only track new additions to the file) and <code>grep</code> (for string searching). Note that there is one trick: <strong>grep needs to search one line at a time, as input arrives</strong>, using the <code>--line-buffered</code> flag:</p>
<pre><code>tail -c <span class="hljs-number">0</span> -f <span class="hljs-built_in">log</span>.txt |grep --line-buffered -i <span class="hljs-built_in">error</span> &gt; <span class="hljs-built_in">errors</span>.txt
</code></pre>
<p>Note that I redirect the matches to &quot;errors.txt&quot;.</p>
<h1 id="debouncing-events">Debouncing events</h1>
<p>Now comes the secret sauce.</p>
<p>One issue with alerts is that they often arrive in bursts. Rather than get hit with an avalanche of alerts, it&#39;s helpful to &quot;debounce&quot; alerts by limiting the alerts to, say, at most one every 15 minutes (or probably even less frequent).</p>
<p>My original solution to this relied on a bunch of custom code, but it turns out that you can build a really simple solution using <code>inotifywait</code> (from <code>inotify-tools</code> on Debian) and a trivial shell script. I named the script &quot;ow.sh&quot; (for &quot;on write&quot;):</p>
<pre><code class="language-bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># ow.sh (&quot;on write&quot;)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This is a script to &quot;debounce&quot; commands that run when a file/directory is</span>
<span class="hljs-comment"># modified. The command is only run at most every TIMESPAN amount of time</span>
<span class="hljs-comment"># (TIMESPAN format is the same as the sleep command, e.g. 10s, 1m).</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -le 3 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> USAGE: <span class="hljs-variable">$0</span> TARGET TIMESPAN COMMAND
    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Example: <span class="hljs-variable">$0</span> foo.log 15m wall &#x27;Alert!!!&#x27;&quot;</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

target=<span class="hljs-variable">$1</span>
delay=<span class="hljs-variable">$2</span>
<span class="hljs-built_in">shift</span> 2

<span class="hljs-keyword">while</span> inotifywait -qq <span class="hljs-string">&quot;<span class="hljs-variable">$target</span>&quot;</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span>
    <span class="hljs-built_in">sleep</span> <span class="hljs-string">&quot;<span class="hljs-variable">$delay</span>&quot;</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p>All this script does is wait for a file or directory to be modified, run the command, and then sleep the specified amount of time.</p>
<p>Example usage:</p>
<pre><code class="language-sh">ow.sh errors.txt 1m <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Oh no! An alert!&quot;</span>
</code></pre>
<p>This will:</p>
<ul>
<li>Watch &quot;errors.txt&quot;</li>
<li>Debounce to at most every 1 minute (<code>1m</code>)</li>
<li>And run the rest of the command line (<code>echo &quot;Oh no! An alert!&quot;</code>)</li>
</ul>
<h1 id="delivering-notifications">Delivering notifications</h1>
<p>The last step is to actually deliver notifications. How this is done depends heavily on the environment where the monitoring is happening and where the notifications need to be received.</p>
<h2 id="local-desktop">Local desktop</h2>
<p>If monitoring is happening locally on a full-blown Linux desktop computer, this could be as simple as using <code>notify-send</code>:</p>
<pre><code class="language-sh">ow.sh errors.txt 15m notify-send <span class="hljs-string">&quot;Oh no, an alert!&quot;</span>
</code></pre>
<h2 id="remote-server">Remote server</h2>
<p>If monitoring is happening on a remote server, then it&#39;s mostly a matter of pulling in the remote output somehow. This can be done using SSH, <code>netcat</code>, etc.</p>
<p>The simplest approach I&#39;ve found is to just tail the remote file locally. So I run the same command <strong>on the server</strong>, same as above:</p>
<pre><code class="language-sh"><span class="hljs-built_in">tail</span> -c 0 -f log.txt |grep --line-buffered -i error &gt; errors.txt
</code></pre>
<p>And then <strong>on my local desktop environment</strong> I tail the remote file using SSH and write to a local file:</p>
<pre><code class="language-sh">ssh server <span class="hljs-built_in">tail</span> -c 0 -f /home/user/errors.txt &gt; remote-errors.txt
</code></pre>
<p>Note that the <code>tail -c 0 -f /home/user/errors.txt</code> part runs on the server and the <code>&gt; re.txt</code> part runs locally. Finally, I can use the debouncing script and <code>notify-send</code>, as before:</p>
<pre><code class="language-sh">ow.sh remote-errors.txt 15m notify-send <span class="hljs-string">&quot;Oh no, an alert!&quot;</span>
</code></pre>
<h2 id="phone-notifications">Phone notifications</h2>
<p>Phone notifications are where my knowledge runs out. I don&#39;t know the best way to send notifications to a phone, especially in a self-hosted way. In the past, I&#39;ve relied on free tiers of paid services, but I&#39;m hopeful I can eventually figure out something that is fully self-hosted (except for the app itself and associated notification infrastructure).</p>
<p>Here are a few ideas:</p>
<h3 id="ifttt">IFTTT</h3>
<p>(Edit: IFTTT no longer supports phone notifications via webhook on the free plan.)</p>
<h3 id="ntfysh">ntfy.sh</h3>
<p><a href="https://ntfy.sh/">ntfy.sh</a> is an awesome service that allows sending phone notifications without even signing up for an account. Don&#39;t forget to donate!</p>
<h3 id="matrix">Matrix</h3>
<p>I strongly suspect there is some way to use <a href="https://matrix.org/">Matrix</a> and an associated phone app for notifications, but I haven&#39;t investigated this option yet.</p>
<h1 id="recap">Recap</h1>
<p>So there it is, alerting for hobby projects using only:</p>
<ul>
<li>Output redirection</li>
<li><code>tail</code></li>
<li><code>grep</code></li>
<li>Bash</li>
<li><code>inotifywait</code></li>
<li><code>sleep</code></li>
<li>SSH</li>
<li>And <code>notify-send</code> or some phone equivalent</li>
</ul>

<footer>
<p>&crarr; <a href="../../index.html">Back to home</a></p>
</footer>
</article>
</main>

</body>
</html>
